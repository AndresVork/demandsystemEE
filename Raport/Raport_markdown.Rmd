---
title: "Tarbimise elastsused"
author: "Andres VÃµrk, Taavi Unt, TÃœ CITIS"
date: "Versioon: `r format(Sys.time(), '%d.%m.%Y')`"
output:
  html_document:
    code_folding: hide
    toc: true
    toc_float: true
editor_options:
  
  chunk_output_type: console
---

<style type="text/css">

body{ /* Normal  */
      font-size: 14px;
  }
td {  /* Table  */
  font-size: 12px;
}
h1.title {
  font-size: 24px;
  color: DarkRed;
}
h1 { /* Header 1 */
  font-size: 20px;
  color: DarkBlue;
}
h2 { /* Header 2 */
    font-size: 18px;
  color: DarkBlue;
}
h3 { /* Header 3 */
  font-size: 16px;
  font-family: "Times New Roman", Times, serif;
  color: DarkBlue;
}
code.r{ /* Code block */
    font-size: 12px;
}
pre { /* Code block - determines code spacing between lines */
    font-size: 14px;
}
</style>


```{r setup, include=FALSE}
knitr::opts_chunk$set(
	echo = TRUE,
	message = FALSE,
	warning = FALSE
)
library(tidyverse)

# setwd("C:/Users/avork/Documents/demandsystemEE")
 
```

## Sissejuhatus

KÃ¤esolev analÃ¼Ã¼s hindab tarbimise hinna- ja kogukulutuste elastused. AnalÃ¼Ã¼s on tehtud projekti "Projekti C-19 majandus ehk COVID-19 seotud majandusmÃµjude ning nende pehmendamiseks mÃµeldud poliitikameetmete tÃµhususe hindamine" raames (https://c19majandus.ut.ee/) ning on sisendiks projekti kÃ¤igus loodud simulatsioonimudelile. AnalÃ¼Ã¼sis kasutatakse leibkonna-eelarve uuringu andmeid kulutuste struktuuri kohta ja tarbijahinnaindeksi komponente kaubagruppide hindade kohta. Elastsuste leidmiseks kasutatakse nÃµudlussÃ¼steemi hindamisel saadud parameetreid. AnalÃ¼Ã¼s annab esmalt Ã¼levaate nÃµudluse modelleerimise mikroÃ¶konoomilistest alustest. SeejÃ¤rel kirjeldatakse kasutatavaid andmeid,  analÃ¼Ã¼simeetodeid ja tulemusi. AndmeanalÃ¼Ã¼si aluseks olevad Ri koodid on kÃ¤ttesaadavad githubis https://github.com/AndresVork/demandsystemEE .



## NÃµudluse modelleerimine


![Tabel 1. NÃµudluse modelleerimise tasemed](tabelsissejuhatusjpg.jpg){width=500px}


### Meeldetuletus majapidamisteooriast

1.samm: tarbimiskulude suuruse mÃ¤Ã¤ramine

  - Tarbija maksimeerib heaolu  $ğ‘ˆ=ğ‘ˆ(ğ¿,ğ¶)$
  - Arvestades ajapiirangut     $ğ¿_0=ğ¿+â„$
  - Ja eelarvepiirangut         $ğ‘ğ¶=ğ‘¤â„+ğ‘…$
  - Leiame optimaalse tÃ¶Ã¶tunnid $â„=ğ¹(ğ‘¤,ğ‘,ğ‘…)$ 
 ja tarbimiskulutused $â„=ğ¹(ğ‘¤,ğ‘,ğ‘…)$

Kui tarbimise kogukulud teada, siis teise sammuna modelleerime nende jagunemist kaupade vahel. 
  - Eelarvepiirang vÃµib olla ka mittelineaarne tÃ¶Ã¶tundide suhtes (nt mittelineaarse maksusÃ¼steemi vÃµi toetuste korral): R(h), w(h)
  - DÃ¼naamilises mudelis lisandub sÃ¤Ã¤stmine, millega silutakse tarbimist.


2.samm: tarbimise struktuuri mÃ¤Ã¤ramine

  - Tarbija maksimeerib heaolu 
  $$ğ‘ˆ=ğ‘ˆ(ğ‘_1,ğ‘_2,...,ğ‘_ğ‘˜)$$
  
  - Arvestades eelarvepiirangut 
  $$ğ‘_1 ğ‘_1Ã—ğ‘_2 ğ‘_2Ã—...ğ‘_ğ‘˜ ğ‘_ğ‘˜=ğ‘¦$$
  
  kus y â€“ kogutarbimine vÃµi kogu sissetulek
      
  - Lahendame sÃ¼steemi => saame Marshalli nÃµudlusfunktsioonid, kus tarbitav kogus sÃµltub hindadest ja sissetulekust.
  
$$
\begin{aligned}
ğ‘_1=ğ‘“_1 (ğ‘_1,ğ‘_2...ğ‘_ğ‘˜,ğ‘¦)  \\
ğ‘_2=ğ‘“_2 (ğ‘_1,ğ‘_2...ğ‘_ğ‘˜,ğ‘¦)  \\ 
...                               \\
ğ‘_ğ‘˜=ğ‘“_ğ‘˜ (ğ‘_1,ğ‘_2...ğ‘_ğ‘˜,ğ‘¦)
\end{aligned}
$$




  - Defineerime i-nda kauba kulutuste osakaalu kogukulutustes $ğ‘¤_ğ‘–=ğ‘_ğ‘–q_ğ‘–/ğ‘¦$
    
  
VÃµime hinnata seoseid jÃ¤rgmisel kujul:

$$
\begin{aligned}
\text{kogus   } & ğ‘_ğ‘–=ğ‘“_ğ‘– (ğ‘_1,ğ‘_2...ğ‘_ğ‘˜,ğ‘¦)+ğ‘¢_ğ‘– \\
\text{kulutus   } & ğ‘_ğ‘– ğ‘_ğ‘–=ğ‘“_ğ‘– (ğ‘_1,ğ‘_2...ğ‘_ğ‘˜,ğ‘¦)+ğ‘¢_ğ‘– \\
\text{osakaal   } &ğ‘¤_ğ‘–=ğ‘“_ğ‘– (ğ‘_1,ğ‘_2...ğ‘_ğ‘˜,ğ‘¦)+ğ‘¢_ğ‘–
\end{aligned}
$$


### Duaalsused majapidamisteoorias

MikroÃ¶konoomika majapidamisteooria eelduste kohaselt on omavahel seotud kasulikkuse maksimeerimine vÃµi kulude minimeerimine, Hicksi nÃµudlusfunktsioonid ja Marshalli nÃµudlusfunktsioonid, kulufunktsioon ja kaudne kasulikkusfunktsioon. Sellest tulenevalt saab pÃ¼stitada ja hinnata nÃµudlussÃ¼steeme erineval kujul ning tuletada vajalikud nÃ¤itajad hinnatud parameetritest.

![Tabel 2. Duaalsusseosed majapidamisteoorias](duaalsusedmajapidamisteoorias.jpg){width=500px}

### Elastsused

AnalÃ¼Ã¼tikutena olema huvitatud nii nÃµudluse absoluutsetest muutustest hindade ja sissetuleku muutudes kui ka elastsustest:

  - Oma hinna muutuse mÃµju: $ğœ•ğ‘_ğ‘–/ğœ•ğ‘_ğ‘–$
  - Teise kauba hinna muutuse mÃµju: $ğœ•ğ‘_ğ‘–/ğœ•ğ‘_ğ‘—$
  - Sissetuleku (vÃµi kogukulutuste) muutuse  mÃµju: $ğœ•ğ‘_ğ‘–/ğœ•ğ‘¦$

Elastsused: 

  - Omahinnaelastus: 
  
  $$ğ‘’_{ii}=(ğœ•ğ‘_ğ‘–/ğ‘_ğ‘–)/(ğœ•ğ‘_ğ‘–/ğ‘_ğ‘–)=ğœ•lnğ‘_ğ‘–/ğœ•lnğ‘_ğ‘–$$
  
  - Hinna ristelastus: 
  
  $$ğ‘’_{ij}=(ğœ•ğ‘_ğ‘–/ğ‘_ğ‘–)/(ğœ•ğ‘_j/ğ‘_j)=ğœ•lnğ‘_ğ‘–/ğœ•lnğ‘_j$$
    
  - Sissetulekuelastsus (Engeli kÃµver) vÃµi kogukulutuste elastsus:
  
  $$ğ‘’_{i}=(ğœ•ğ‘_ğ‘–/ğ‘_ğ‘–)/(ğœ•y/y)=ğœ•lnğ‘_ğ‘–/ğœ•lny$$
  


### NÃµudlusfunktsioonid

*Hicksi nÃµudlus* (ehk kompenseeritud nÃµudlus):

NÃ¤itab, kuidas muutub nÃµutav kaubakogus, kui muutub hind, teiste hindade ja kasulikkuse taseme samaks jÃ¤Ã¤des: 

$â„_ğ‘–=â„(ğ‘_1,ğ‘_2,...,ğ‘_ğ‘˜,ğ‘ˆ^âˆ—)$

Seega muutuvad kulutused.


*Marshalli nÃµudlus* (ehk kompenseerimata nÃµudlus): 

NÃ¤itab, kuidas muutub nÃµutav kaubakogus, kui muutub hind, teiste hindade ja kogukulutuste samaks jÃ¤Ã¤des

$ğ‘_ğ‘–=ğ‘(ğ‘_1,ğ‘_2,...,ğ‘_ğ‘˜,ğ‘¦)$

Seega muutub kasulikkus


### Slutsky vÃµrrand

$$ğœ•ğ‘_ğ‘–/ğœ•ğ‘_ğ‘—=ğœ•â„_ğ‘–/ğœ•ğ‘_ğ‘—âˆ’ğœ•ğ‘_ğ‘–/ğœ•ğ‘¦Ã—ğ‘_ğ‘—$$
Slutsky vÃµrrand nÃ¤itab, et koguse muutus tulenevalt hinna muutusest (Marshalli nÃµudlus) sÃµltub asendusefektist ja sissetulekuefektist.

Asendusefekt nÃ¤itab, mis juhtub kogusega, kui muutuvad suhtelised hinnad, aga kasulikkus jÃ¤Ã¤b samaks. (Sissetuleku langus kompenseeritakse.)

Sissetulekuefekt nÃ¤itab, kuidas muutub kogus, kui muutub sissetulek.

Elastsuste kujul Slutsky vÃµrrand: 

$ğ‘’_{ğ‘–ğ‘—}=ğ‘’_{ğ‘–ğ‘—}^âˆ— âˆ’ğ‘’_ğ‘–Ã—ğ‘¤_ğ‘—$

Marshalli elastsus = Hicksi elastsus - sissetulekuelastsus korda osakaal tarbimiskuludes.


### ÃœhevÃµrrandilised Ã¶konomeetrilised mudelid

ÃœhevÃµrrandilised mudelid on sobivad kitsa tootegrupi analÃ¼Ã¼simiseks.


![Tabel. ÃœhevÃµrrandilised mudelid](yhevorrandilisedmudelid.jpg){width=500px}

### Pidevad Ã¼hevÃµrrandilised mudelid


Lineaarne mudel:
$$ğ‘_i=ğ›¼+ğ›½_1 ğ‘_i+ğ›½_2 ğ‘_j+ğ›½_3 ğ»+ğ›¾ğ‘¦+ u_i$$

Logaritmkujul:

$$log(q_i)= \alpha + e_i log(y) + \sum_{j=1}^k e_{ij}log(p_j) + u_i$$


**Stoneâ€™i mudel:**

$$
\begin{aligned}
log(q_i) & = \alpha + e_i log(y/P) + \sum_{j=1}^k e_{ij}log(p_j) + u_i \\
logP & = \sum_{j=1}^k w_j log(p_j)
\end{aligned}
$$


**Working-Leserâ€™i mudel**

Hindame kulutuste osakaalu sÃµltuvust sissetulekust, hindadest ja muudest leibkondade iseloomustavatest teguritest.


$$w_i= \alpha_0 + \alpha_i log(y) + \sum_{j=1}^k \beta_{ij}log(p_j) + \lambda H_i + u_i$$

Kompenseerimata omahinnaelastsus

$$ ğ‘’_{ii} =âˆ’1+ğ›½_{ii}/ğ‘¤_ğ‘– $$

Risthinnaelastus $$ğ‘’_{ij}=ğ›½_{ij}/ğ‘¤_ğ‘–$$

Sissetulekuelastsus $$ ğ‘’_ğ‘–=1+ğ›¼_ğ‘–/ğ‘¤_ğ‘–$$


Kui mudelis mitte sissetulek vaid kogukulud x, siis vÃµib eraldi hinnata seose, kus kogukulud x  sÃµltuvad sissetulekust y.


Vt Working (1943), Leser (1963) ; vt ka Intriligator, Bodkin and Hsiao (1996) and Deaton and Muellbauer (1980).

Mikroandmete puhul vÃµib hinnata veel ka Working-Leserâ€™i mudel koos tsenseerimisega (Tobit mudel) vÃµi koos selektsiooniga (Heckmani mudel).


<!-- $$ -->
<!-- ğ‘¤_ğ‘–^âˆ—=ğ›¼_0+ğ›¼_ğ‘–  logâ¡( ğ‘¦)+âˆ‘_(ğ‘—=1)^ğ‘˜â–’ã€–ğ›½_ğ‘–ğ‘—  logâ¡( ğ‘_ğ‘—)ã€—+ğœ†ğ»_ğ‘–+ğ‘¢_ğ‘– -->
<!-- ğ‘¤_ğ‘–^âˆ—={â– (ğ‘¤_ğ‘–â€ƒ"kui" â€„ğ‘¤_ğ‘–^âˆ—>0@0â€ƒ"  kui" â€„ğ‘¤_ğ‘–^âˆ—â‰¤0)â”¤â€ƒ"ja"â€ƒğ‘¢_ğ‘–  ~â¡ğ‘ (0,ğœ^2) -->
<!-- $$ -->

<!-- $$ -->
<!-- ğ‘¤_ğ‘–^âˆ—=ğ›¼_0+ğ›¼_ğ‘–  logâ¡( ğ‘¦)+âˆ‘_(ğ‘—=1)^ğ‘˜â–’ã€–ğ›½_ğ‘–ğ‘—  logâ¡( ğ‘_ğ‘—)ã€—+ğœ†ğ»_ğ‘–+ğ‘¢_ğ‘–ğ¼_ğ‘–^âˆ—=ğ›¼_0+ğ›¼_ğ‘–  logâ¡( ğ‘¦)+âˆ‘_(ğ‘—=1)^ğ‘˜â–’ã€–ğ›½_ğ‘–ğ‘—  logâ¡( ğ‘_ğ‘—)ã€—+ğœ†ã€–ğ»^â€²ã€—_ğ‘–+ğ‘£_ğ‘–ğ‘¤_ğ‘–^âˆ—={â– (ğ‘¤_ğ‘–â€ƒ"kui" â€„ğ¼_ğ‘–^âˆ—>0@"pole jÃ¤lgitav" â€ƒ"  kui" â€„ğ¼_ğ‘–^âˆ—â‰¤0)â”¤â€ƒ"ja"â€ƒ(â– (ğ‘¢_ğ‘–@ğ‘£_ğ‘– ))  ~â¡ğ‘ ğ¼ğ·((â– (0@0)),â€„(â– (ğœ_1^2&ğœ_12@ğœ_12&1))) -->

<!-- $$ -->


### TarbimisevÃµrrandite sÃ¼steemid

Kui tegemist on tarbija eelarve oluliste kaubagruppidega, siis peab arvestama, et leibkonnad teevad kulutused simultaanselt ja ei saa iga tootegrupi vÃµrrandid kÃ¤sitleda eraldiseisvalt.

<!-- - â€MÃµnevÃµrrandilised mudelidâ€œ, Nt kaks kauba vÃµrrandit, mis seotud -->

NÃµudlussÃ¼steemi hidamisel on palju erinevaid lÃ¤henemisi. NÃµudlussÃ¼steemi puhul arvestatakse, et eri kulude kogusumma peab vÃµrduma tarbimiskulude kogusummaga.

AlljÃ¤rgnevalt on toodud loetelu vÃµimalikest nÃµudlussÃ¼steemidest.

- The Linear Expenditure System â€“ eeldatud kasulikkusfunktsioon
- The Extended Linear Expenditure Model
- The Rotterdam Model  - hea testida kitsendusi
- The Quadratic Expenditure System
- The Indirect Translog Model â€“ tuletatud kaudsest kasulikkusfunktsioonist
- AIDS - The Almost Ideal Demand System - duaalsusseostest
    - Quadratic AIDS
    - Linear AIDS
- PADS â€“ Perhaps Adequate Demand System
- Censored Demand Systems
- Dynamic Demand Systems
- ...


Esimene, kes tuletas tarbijateooriast nÃµudlusvÃµrrandite sÃ¼steemi (ehk nÃµudlussÃ¼steemi) ja hindas selle oli Stone (1954). Populaarseks hindamismudeliks kujunenud AIDSi vÃµtsid esimesena kasutusele Deaton ja Muellbauer (1980). NÃµudlussÃ¼steeme on empiiriliselt hinnatud paljude riikide koht. 

<!-- NÃ¤iteks on hinnatud sÃ¼steemid Ungari, Poola ja TÅ¡ehhi jaoks (Banse ja Brosig, 1998). Mitmeastmelist eelarvestamist on kasutatud ja seega ka Ã¼ksikute toiduainete gruppide jaoks nÃµudluse hinna- ja sissetulekuelastsused on leitud nÃ¤iteks TÅ¡ehhi (Brosig, 1998) ja Sloveenia, Bulgaaria ning Rumeenia puhul (Mergos ja Mizzi, 1999). Elanikkonda sissetulekute jÃ¤rgi kolmeks grupiks jagades on leitud toiduainete nÃµudluselastsused USA jaoks (Huang ja Lin, 2000). -->



## Metoodika

### Almost Ideal Demand System

Deaton,A., Muellbauer,J. An Almost Ideal Demand System. American Economic Review, vol. 70, No. 3, June 1980, pp.312 â€“ 326

(+) Rahuldab teoreetilisi kitsendusi

(-) Hinnaindeks parameetrite suhtes mittelineaarne - keeruline hinnata ning Engeli kÃµverad mittelineaarsed. Selle tÃµttu vÃµib mÃµni osakaal minna negatiivseks kui sissetulek kasvab.


Hindame seosed osakaalude kujul:

$$w_i= \alpha_i + \sum_{j=1}^k \gamma_{ij}log(p_j) +  \beta_i log(Y/P) $$
Hinnaindeks on translog hinnaindeks

$$logP= \alpha_0 + \sum_{j=1}^k \alpha_{j}log(p_j) + \sum_{i=1}^k\sum_{j=1}^k \gamma_{ij}log(p_i)log(p_j)$$

Peale mudeli parameetrite hindamist saab leida elastsused:

Otsene hinnaelastsus

$$\varepsilon_{ii}=(\gamma_{ij}-\beta_i \times w_i)/ğ‘¤_i - 1$$

Sissetulekuelastsus

$$\varepsilon_i = 1+\beta_i / w_i $$
Elastused vÃµib leida, kas keskmiste osakaalude juures vÃµi leida kÃµikide vaatluste jaoks ning siis leida keskmine Ã¼le elastsuste.


### Linear Approximate Almost Ideal Demand System 

Et translog hinnaindeksit on keeruline hinnata, sest tegemist on vÃ¤ga mittelineaarse sÃ¼steemiga, siis kasutatakse hinnaindeksi puhul lineaarset lÃ¤hendit.

LA-AIDS = AIDS koos lineaarse hinnaindeksiga

$$w_i= \alpha_i + \sum_{j=1}^k \gamma_{ij}\log(p_j) +  \beta_i \log(Y/P) $$

Stoneâ€™i hinnaindeks

$$lnP^* = \sum_{j=1}^k w_{j} \log p_j$$ 

Laspeyrese hinnaindeks

$$lnP^L = \sum_{j=1}^k \bar w_{j} \log p_j$$ 
Esineb ka teisi lÃ¤hendusi hinnaindeksitele. Hinnatud parameetritest saab avaldada elastused. Esinevad erinevad lÃ¤hendid (AIDS, Green + Alston, Goddard, Chalfant, Eales + Unnevehr)


_TODO:! TÃ¤psustada elastsuste erinevad valemid_



## Andmed

AlljÃ¤rgnevalt kasutame Leibkonna Eelarve Uuringu andmeid tarbimiskulutuste kohta tarbimiskvantiilide lÃµikes. Perioodi 1996-2007 on andmed detsiilide lÃµikes ning perioodi 2010-2019 aasta kohta kvintiilide lÃµikes.

  1) ESA tabel LE209: LEIBKONNALIIKME KULUTUSED AASTAS KULUKVINTIILI JÃ„RGI
https://andmed.stat.ee/et/stat/sotsiaalelu__leibkonnad__leibkonna-eelarve__aasta-kulutused/LE209

  2) LE113: LEIBKONNALIIKME KULUTUSED KUUS LEIBKONNA KULUDETSIILI JÃ„RGI (1996-2007) https://andmed.stat.ee/et/stat/Lepetatud_tabelid__Sotsiaalelu.%20Arhiiv__Leibkonnad.%20%20Arhiiv__kuu-kulutused/LE113

Hinnad on vÃµetud Eurostatist HICP andmetest. 

https://appsso.eurostat.ec.europa.eu/nui/show.do?dataset=prc_hicp_aind&lang=en


LÃ¤hteandmed on antud jÃ¤rgmistes gruppides (COICOP esimesel tasemel)


LEU 1996-2007 | LEU 2010-2019 | Prices|
|-------------|-------------|--------------|
|Expenditure total | Expenditure total | |
|Consumption expenditure | Consumption expenditure | CP00 - All-items HICP|
|Food and non-alcoholic beverages | Food and non-alcoholic beverages | CP01 - Food and non-alcoholic beverages|
|Alcoholic beverages | Alcoholic beverages and tobacco | CP02 - Alcoholic beverages, tobacco and narcotics|
|Tobacco |  | |
|Clothing and footwear | Clothing and footwear | CP03 - Clothing and footwear|
|Housing | Housing | CP04 - Housing, water, electricity, gas and other fuels|
|Household equipment and operation | Household equipment and operation | CP05 - Furnishings, household equipment and routine household maintenance|
|Health | Health | CP06 - Health|
|Transport | Transport | CP07 - Transport|
|Communication services | Communication | CP08 - Communications|
|Recreation, leisure and entertainment | Recreation and culture | CP09 - Recreation and culture|
|Education | Education | CP10 - Education|
|Hotels, cafÃ©s, restaurants | Restaurants and hotels | CP11 - Restaurants and hotels|
|Miscellaneous goods and services | Miscellaneous goods and services | CP12 - Miscellaneous goods and services|
|Non-monetary consumption |  | |
|Other expenditure | Other expenditure |  |


Varasemate LEU andmete puhul agregeeritakse alkoholi ja tubakatoodete tarbimine Ã¼htsesse gruppi ning jÃ¤etakse vÃ¤lja mitterahalised kulud. 

Puuduvad andmed kvintiilide mÃµnede kulutuste kategooriate kohta (nt haridus aastatel 2005-2007) on leitud kasutades olemasolevate andmete keskmist vÃ¤Ã¤rtust vastavalt eraldi vana ja uue LEU andmete kohta.

Kokku tarbimiskulude leibkonnakvantiilide lÃµikes on toodud jÃ¤rgmisel joonisel.


```{r}

load(file = "../Andmed/hbsexppriceslevel1.RData")
#load(file = "Andmed/hbsexppriceslevel1.RData")

ggplot(hbsexppriceslevel1 %>% group_by(year, quantile) %>% slice(1), aes(x=year, y = consexp, color = as.factor(quantile))) +
  geom_line() +
  geom_point() +
  labs(color = "Quantile", x ="", y = "Annual expenditure per household member, EUR") +
  theme_bw()+
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))


```


Osakaalude andmed on toodud jÃ¤rgmisel joonisel. Aastate 1995-2007 kohta on antud andmed detsiilide kohta ning aastate 2010-2019 kohta on kvintiilide kohta.


```{r}

#Shares
ggplot(hbsexppriceslevel1, aes(x=year, y = share, color = as.factor(quantile))) +
  geom_line() +
  geom_point() +
  facet_wrap(~coicop, scales = "free_y") + 
  labs(color = "Quantile", x ="", y = "Share") +
  theme_bw()+
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))


```

Hinnaindeksite dÃ¼naamika on esitatud jÃ¤rgmisel joonisel


```{r}

load(file = "../Andmed/hicp_en.RData")
#load(file = "Andmed/hicp_en.RData")
commodities <- unique(hbsexppriceslevel1$coicop)

temp <- hicp_en %>% filter(geo =="EE", unit == "INX_A_AVG", coicop %in% c(commodities, "CP00"))

ggplot(temp, aes(x=time, y = values, color = coicop)) +
  geom_line() +
  geom_point() +
  labs(color = "Commodity group", x ="", y = "Price index") +
  theme_bw()+
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))

```



## Mudel


Kasutame Ri paketis `micEconAids` toodud funktsioone `aidsEst` AIDS mudeli hindamiseks ja `elas` hinna ja kogukulutuste elastuse hindamiseks. 

vt https://cran.r-project.org/web/packages/micEconAids/vignettes/micEconAids_vignette.pdf

Tulemused kasutades Stone'i hinnaindeksit on jÃ¤rgmised.

```{r}
library("micEconAids")

#First put price and share into single variable
df <- hbsexppriceslevel1 %>% gather(key = "xvar", value  = "value", -year, -quantile, -coicop, -consexp)
#Merge values to get new variable names
df <- df %>% mutate(x = paste0(coicop, xvar))
#Shape back to wide
dfw <- df %>% select(year, quantile, consexp, x, value) %>% spread(key = "x", value = "value") %>% 
  as.data.frame()

priceNames <- setdiff(colnames(dfw)[grepl("price", colnames(dfw))], "CP00price")
shareNames <- setdiff(colnames(dfw)[grepl("share", colnames(dfw))], "CP00share")

laaidsResult <- aidsEst( priceNames, shareNames, "consexp", data = dfw,  priceIndex = "S" )

print(laaidsResult)

```


Kulutuste elastsuste punkthinnangud koos ligilÃ¤hedase 95% usaldusintervalliga

```{r}
pMeans <- colMeans( dfw[ , priceNames ] )
wMeans <- colMeans( dfw[ , shareNames ] )
xtMean <- mean( dfw[ , "consexp" ] )

aidsResultElasCov <- aidsElas( coef( laaidsResult), prices = pMeans, totExp = xtMean, coefCov = vcov( laaidsResult), df = df.residual( laaidsResult), priceIndex = "S")

temp <- aidsResultElasCov
punkthinnang <- temp$exp
standardvead <- temp$expStEr

tempdf <- as.data.frame(cbind(punkthinnang,standardvead))
coicopnimed <- c("Toit ja alkoholita joogid", "Alkohol ja tubakas", "RÃµivad, jalatsid", "Eluase", 
"Majapidamiskulud", "Tervishoid", "Transport", "Side", "Vaba aeg", "Haridus", "Restoranid, hotellid", "Muud")
tempdf$coicop <- factor(coicopnimed, levels = coicopnimed)

ggplot(tempdf) +
  geom_errorbar(aes(x=coicop, ymin=punkthinnang-2*standardvead, 
                    ymax = punkthinnang + 2*standardvead), width=0.2, size=1, color="blue") + 
geom_point(data=tempdf, mapping=aes(x=coicop, y=punkthinnang), size=4, shape=15, fill="white") +
labs(title="Kogukulutuste elastsus", y = "elastsus", x="")  +
  coord_flip() +
  geom_hline(yintercept=1)+
    theme_bw()

```


Marshalli omahinnaelastsused koos ligilÃ¤hedaste 95% usaldusintervallidega


```{r}

punkthinnang <-diag(temp$marshall)
standardvead <- diag(temp$marshallStEr)

tempdf <- data.frame(cbind(punkthinnang, standardvead))
tempdf$coicop <- factor(coicopnimed, levels = coicopnimed)

ggplot(tempdf) +
  geom_errorbar(aes(x=coicop, ymin=punkthinnang-2*standardvead, ymax = punkthinnang + 2*standardvead), width=0.2, size=1, color="blue") + 
geom_point(data=tempdf, mapping=aes(x=coicop, y=punkthinnang), size=4, shape=15, fill="white") +
labs(title="Marshalli hinnaelastsused", y = "elastsus", x = "")  +
    coord_flip() +
    geom_hline(yintercept=0)+
  theme_bw()

```


Hicksi omahinnaelastsused koos ligilÃ¤hedaste 95% usaldusintervallidega.

```{r}

punkthinnang <-diag(temp$hicks)
standardvead <- diag(temp$hicksStEr)

tempdf <- data.frame(cbind(punkthinnang, standardvead))
tempdf$coicop <- factor(coicopnimed, levels = coicopnimed)

ggplot(tempdf) +
  geom_errorbar(aes(x=coicop, ymin=punkthinnang-2*standardvead, ymax = punkthinnang + 2*standardvead), width=0.2, size=1, color="blue") + 
geom_point(data=tempdf, mapping=aes(x=coicop, y=punkthinnang), size=4, shape=15, fill="white") +
labs(title="Hicksi hinnaelastsused", y = "elastsus", x = "")  +
    coord_flip() +
    geom_hline(yintercept=0)+
  theme_bw()

```


Nagu nÃ¤ha, siis hinnaelastsused on vÃ¤ga ebatÃ¤pselt hinnatud.

### Teha

- testida erinevate hindamismeetodite ja elaststuste lÃ¤hendite mÃµju
- testida deterministliku trendi kasutamise mÃµju (e.g. eelistuste muutus Ã¼le aastate) ja /vÃµi andmete metoodika muutumise mÃµju (indikaator uue ja vana LEU eristamiseks)
- kaaluda paremaid imputeerimismeetodeid


## Lisa

Parameetritele vastavad kÃµik elastsused on jÃ¤rgmised

```{r}
elas(laaidsResult)

```

